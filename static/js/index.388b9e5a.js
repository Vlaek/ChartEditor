(()=>{"use strict";var e,t,o,n,l={908(e,t,o){var n=o(848),l=o(540),r=o(338),a=o(942),d=o.n(a),s=o(913);let i=()=>`id-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,c=(0,o(282).vt)((e,t)=>({nodes:[],edges:[],selectedElement:null,addNode:(o,n)=>{let l=t(),r={id:i(),type:o,position:n,data:{label:`${l.nodes.filter(e=>e.type===o).length+1}`,connections:{top:null,bottom:null}}};e(e=>({nodes:[...e.nodes,r]}))},updateNodePosition:(t,o)=>{e(e=>({nodes:e.nodes.map(e=>e.id===t?{...e,position:o}:e)}))},deleteNode:o=>{let{nodes:n,edges:l}=t();if(!n.find(e=>e.id===o))return;let r=l.filter(e=>e.source===o||e.target===o);e(e=>({nodes:e.nodes.filter(e=>e.id!==o),edges:e.edges.filter(e=>!r.some(t=>t.id===e.id))}))},addEdge:(o,n,l,r)=>{if(o===n)return;let a=t(),d=a.edges,s=t=>{let o=d.find(e=>e.id===t);o&&e(e=>({nodes:e.nodes.map(e=>{if(e.id===o.source||e.id===o.target){let o={...e.data.connections};return o.top===t&&(o.top=null),o.bottom===t&&(o.bottom=null),{...e,data:{...e.data,connections:o}}}return e}),edges:e.edges.filter(e=>e.id!==t)}))},c=a.nodes.find(e=>e.id===o);if(c){let e="top"===l?c.data.connections.top:c.data.connections.bottom;null!==e&&s(e)}let u=a.nodes.find(e=>e.id===n);if(u){let e="top"===r?u.data.connections.top:u.data.connections.bottom;null!==e&&s(e)}if(t().edges.some(e=>e.source===o&&e.target===n&&e.sourceHandle===l&&e.targetHandle===r))return;let p={id:i(),source:o,target:n,sourceHandle:l,targetHandle:r};e(e=>({nodes:e.nodes.map(e=>e.id===o?{...e,data:{...e.data,connections:{...e.data.connections,[l]:p.id}}}:e.id===n?{...e,data:{...e.data,connections:{...e.data.connections,[r]:p.id}}}:e),edges:[...e.edges,p]}))},deleteEdge:t=>{e(e=>{let o=e.edges.find(e=>e.id===t);return o?{nodes:e.nodes.map(e=>{if(e.id===o.source||e.id===o.target){let o={...e.data.connections};return o.top===t&&(o.top=null),o.bottom===t&&(o.bottom=null),{...e,data:{...e.data,connections:o}}}return e}),edges:e.edges.filter(e=>e.id!==t)}:e})},clearDiagram:()=>{e({nodes:[],edges:[],selectedElement:null})},setSelectedElement:t=>{e({selectedElement:t})},saveDiagram:()=>{let e,o,n,{nodes:l,edges:r}=t();e=new Blob([JSON.stringify({nodes:l,edges:r},null,2)],{type:"application/json"}),o=URL.createObjectURL(e),(n=document.createElement("a")).href=o,n.download=`diagram-${Date.now()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)},loadDiagram:t=>{e({nodes:t.nodes,edges:t.edges,selectedElement:null})}}));var u=o(828),p=o(438),h=o(403);o(289);let g={rectangle:5,triangle:5,circle:5},m={rectangle:{label:"rectangle",color:"#3b82f6",width:100,height:80,radius:"4px",clipPath:"none"},triangle:{label:"triangle",color:"#ef4444",width:100,height:80,radius:"0",clipPath:"polygon(50% 0%, 0% 100%, 100% 100%)"},circle:{label:"circle",color:"#10b981",width:100,height:80,radius:"50%",clipPath:"none"}},b=[{id:"top",type:"source",position:s.yX.Top,style:{top:"-6px"}},{id:"top",type:"target",position:s.yX.Top,style:{top:"-6px"}},{id:"bottom",type:"source",position:s.yX.Bottom,style:{bottom:"-6px"}},{id:"bottom",type:"target",position:s.yX.Bottom,style:{bottom:"-6px"}}],f={node__handle:"node__handle-hFDhuW",nodeHandle:"node__handle-hFDhuW","node-outer-wrapper":"node-outer-wrapper-PFGV24",nodeOuterWrapper:"node-outer-wrapper-PFGV24","hover-border":"hover-border-K8F1n3",hoverBorder:"hover-border-K8F1n3","custom-node-wrapper":"custom-node-wrapper-Rhk7VB",customNodeWrapper:"custom-node-wrapper-Rhk7VB","custom-node":"custom-node-E5m87c",customNode:"custom-node-E5m87c","selection-border":"selection-border-OhITEC",selectionBorder:"selection-border-OhITEC",node__label:"node__label-DeafIW",nodeLabel:"node__label-DeafIW",triangle__label:"triangle__label-CIa2U2",triangleLabel:"triangle__label-CIa2U2"},v=(0,l.memo)(e=>{let{id:t,data:o,type:l}=e,r="triangle"===l,a=m[l],i=c(e=>e.selectedElement)===t,u=c(e=>e.setSelectedElement);return(0,n.jsxs)("div",{className:d()(f["node-outer-wrapper"],{[f.selected]:i}),children:[i&&(0,n.jsx)("div",{className:f["selection-border"]}),(0,n.jsx)("div",{className:f["hover-border"]}),(0,n.jsxs)("div",{className:f["custom-node-wrapper"],children:[(0,n.jsx)("div",{className:d()(f["custom-node"],{[f.triangle]:r}),onClick:()=>{u(t)},onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),u(t))},tabIndex:0,role:"button",style:{width:a.width,height:a.height,backgroundColor:a.color,borderRadius:a.radius,clipPath:a.clipPath},children:(0,n.jsx)("div",{className:d()(f.node__label,{[f.triangle__label]:r}),children:o.label})}),b.map(e=>(0,n.jsx)(s.h7,{type:e.type,position:e.position,id:e.id,className:f.node__handle,style:e.style},e.id+e.type))]})]})}),y={rectangle:v,triangle:v,circle:v},x=()=>{let e=c(e=>e.nodes),t=c(e=>e.edges),o=c(e=>e.addEdge),r=c(e=>e.updateNodePosition),a=c(e=>e.deleteNode),d=c(e=>e.deleteEdge),i=c(e=>e.selectedElement),g=c(e=>e.setSelectedElement),[m,b,f]=(0,s.ck)(e),[v,x,_]=(0,s.fM)(t);(0,l.useEffect)(()=>{b(e)},[e,b]),(0,l.useEffect)(()=>{x(t)},[t,x]),(0,l.useEffect)(()=>{let e=e=>{("Delete"===e.key||"Backspace"===e.key)&&i&&(e.preventDefault(),t.some(e=>e.id===i)?d(i):a(i),g(null))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[i,t,d,a,g]);let j=(0,l.useCallback)(e=>{e.source&&e.target&&e.sourceHandle&&e.targetHandle&&o(e.source,e.target,e.sourceHandle,e.targetHandle)},[o]),E=(0,l.useCallback)((e,t)=>{r(t.id,t.position)},[r]),N=(0,l.useCallback)((e,t,o)=>{o.length>1&&o.forEach(e=>{r(e.id,e.position)})},[r]),k=(0,l.useCallback)((e,t)=>{g(t.id)},[g]),w=(0,l.useCallback)((e,t)=>{g(t.id)},[g]),C=(0,l.useCallback)(()=>{g(null)},[g]);return(0,n.jsx)("div",{className:"editor-container-IiH9kV",children:(0,n.jsxs)(s.Gc,{nodes:m,edges:v,onNodesChange:f,onEdgesChange:_,onConnect:j,onNodeDragStop:E,onNodeDrag:N,onEdgeClick:k,onNodeClick:w,onPaneClick:C,nodeTypes:y,connectionMode:s.WZ.Loose,connectionLineType:s.Do.SmoothStep,isValidConnection:e=>{let{source:t,target:o}=e;return t!==o},attributionPosition:"bottom-right",deleteKeyCode:null,children:[(0,n.jsx)(u.V,{}),(0,n.jsx)(p.H,{}),(0,n.jsx)(h.o,{})]})})},_=["rectangle","triangle","circle"],j={rectangle:"Квадрат",triangle:"Треугольник",circle:"Круг"},E=()=>{let e=c(e=>e.addNode),t=c(e=>e.nodes),{screenToFlowPosition:o}=(0,s.VH)(),r=(0,s.PI)(),a=(0,l.useCallback)(e=>t.filter(t=>t.type===e).length,[t]);return(0,n.jsxs)("div",{className:"sidebar-NDmIsQ",children:[(0,n.jsx)("h2",{className:"sidebar__title-TfcLXJ",children:"Фигуры"}),(0,n.jsx)("div",{className:"shape__list-RicQ04",children:_.map(t=>{let l=m[t],s=a(t),i=s>=g[t],c=j[l.label];return(0,n.jsxs)("button",{className:d()("shape__card-DFEJy6",{"shape__card--disabled-W_6lNU":i}),onClick:()=>!i&&(t=>{if(a(t)>=g[t])return;let{width:n,height:l}=r.getState(),d=o({x:n/2-m[t].width/2,y:l/2-m[t].height/2});e(t,d)})(t),disabled:i,children:[(0,n.jsx)("div",{className:"shape__preview-sbQFfA",style:{backgroundColor:l.color,width:.6*l.width,height:.6*l.height,borderRadius:l.radius,clipPath:l.clipPath}}),(0,n.jsx)("div",{className:"shape__info-yAdEDM",children:(0,n.jsx)("span",{className:"shape-label",children:c})}),(0,n.jsxs)("span",{className:"shape__count-Q8fKkc",children:[s,"/",g[t]]})]},t)})})]})},N="toolbar__btn-gDZHZD",k="Диаграмма импортирована успешно!",w="Ошибка при импорте диаграммы",C="Неизвестная ошибка",D="Сохранить диаграмму",O="Добавьте элементы, чтобы сохранить диаграмму",P="Импортировать диаграмму",H="Очистить диаграмму",I="Нет элементов для очистки",L=()=>{let e=c(e=>e.saveDiagram),t=c(e=>e.loadDiagram),o=c(e=>e.clearDiagram),r=c(e=>e.nodes),a=(0,l.useRef)(null),s=r.length>0,i=async e=>{var o;let n=null==(o=e.target.files)?void 0:o[0];if(n)try{let e=await new Promise((e,t)=>{let o=new FileReader;o.onload=o=>{try{var n;let t=null==(n=o.target)?void 0:n.result,l=JSON.parse(t);if(!l.nodes||!l.edges)throw Error("Некорректный формат файла диаграммы");l.nodes.forEach((e,t)=>{if(!e.id||!e.type||!e.position||!e.data)throw Error(`Некорректный узел на позиции ${t}`)}),l.edges.forEach((e,t)=>{if(!e.id||!e.source||!e.target)throw Error(`Некорректная связь на позиции ${t+1}`)}),e(l)}catch(e){t(e)}},o.onerror=()=>{t(Error("Ошибка чтения файла"))},o.readAsText(n)});t(e),alert(k)}catch(t){let e=t instanceof Error?t.message:C;alert(`${w}: ${e}`)}finally{a.current&&(a.current.value="")}};return(0,n.jsx)("div",{className:"toolbar-fqkBlY",children:(0,n.jsxs)("div",{className:"toolbar__group-Vi35jW",children:[(0,n.jsx)("button",{className:N,onClick:e,disabled:!s,title:s?D:O,children:"Сохранить"}),(0,n.jsx)("button",{className:N,onClick:()=>{var e;return null==(e=a.current)?void 0:e.click()},title:P,children:"Импорт"}),(0,n.jsx)("input",{ref:a,type:"file",accept:".json",onChange:i,style:{display:"none"}}),(0,n.jsx)("button",{className:d()(N,"toolbar__btn--danger-JpHxgd"),onClick:o,disabled:!s,title:s?H:I,children:"Очистить"})]})})},R="flexContainer-zMThV2",S=()=>(0,n.jsx)(s.Ln,{children:(0,n.jsxs)("div",{className:R,children:[(0,n.jsx)(E,{}),(0,n.jsxs)("div",{className:d()(R,"flexContainer--column-kIOSeq"),children:[(0,n.jsx)(L,{}),(0,n.jsx)(x,{})]})]})}),B=document.getElementById("root");B&&r.createRoot(B).render((0,n.jsx)(l.StrictMode,{children:(0,n.jsx)(()=>(0,n.jsx)("div",{className:"app-wBGAKx",children:(0,n.jsx)(S,{})}),{})}))}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return l[e](o,o.exports,a),o.exports}a.m=l,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var o in t)a.o(t,o)&&!a.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=[],a.O=(t,o,n,l)=>{if(o){l=l||0;for(var r=e.length;r>0&&e[r-1][2]>l;r--)e[r]=e[r-1];e[r]=[o,n,l];return}for(var d=1/0,r=0;r<e.length;r++){for(var[o,n,l]=e[r],s=!0,i=0;i<o.length;i++)(!1&l||d>=l)&&Object.keys(a.O).every(e=>a.O[e](o[i]))?o.splice(i--,1):(s=!1,l<d&&(d=l));if(s){e.splice(r--,1);var c=n();void 0!==c&&(t=c)}}return t},t={410:0},a.O.j=e=>0===t[e],o=(e,o)=>{var n,l,[r,d,s]=o,i=0;if(r.some(e=>0!==t[e])){for(n in d)a.o(d,n)&&(a.m[n]=d[n]);if(s)var c=s(a)}for(e&&e(o);i<r.length;i++)l=r[i],a.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return a.O(c)},(n=self.webpackChunkChartEditor=self.webpackChunkChartEditor||[]).forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n));var d=a.O(void 0,["783","780"],()=>a(908));d=a.O(d)})();